> **Note**: This documentation was generated by AI and may contain inaccuracies. Please verify information and refer to the source code for authoritative details.

# Pipeline Estimator

## Overview

The **Pipeline Estimator** estimates API quota costs and execution metrics before running a pipeline. This helps prevent accidental quota exhaustion and plan API usage.

## Purpose

Pipeline estimators provide:

- **Quota Estimation** — Calculate total API quota cost
- **Execution Metrics** — Estimate execution time and data volumes
- **Cost Transparency** — See costs before execution
- **Planning Tool** — Plan and budget API usage

## Usage

### Basic Estimation

```python
from yt_pipeline.pipeline import Pipeline, PipelineStacks, PipelineBlocksConstructor, PipelineEstimator
from yt_pipeline.retriever import RetrieverSettings, PipeSettings, SearchParamProps

# Build pipeline
constructor = PipelineBlocksConstructor(
    retriever_settings=RetrieverSettings(multithread=True),
    pipe_settings=PipeSettings(max_page=1)
)

pipeline_blocks = constructor.construct(
    "search(video)<max_page(1)> -> videos -> comments<max_page(2)>"
)

stacks = PipelineStacks(
    initial_input=[SearchParamProps(q="python")],
    blocks=pipeline_blocks
)

pipeline = Pipeline(stacks=stacks, developerKey=devKey)

# Estimate quota
estimator = PipelineEstimator(pipeline)
report = estimator.estimate()

# Display all metrics
report.display(metrics="all")
```

### Accessing Metrics

```python
report = estimator.estimate()

# Overall metrics
print(f"Total Quota: {report.overall_cost}")
print(f"Estimated Time: {report.estimated_time} seconds")
print(f"Total Input Items: {report.total_input_items}")
print(f"Total Output Items: {report.total_output_items}")

# Per-stage metrics
for stage in report.stages:
    print(f"Stage: {stage.worker_name}")
    print(f"  Quota: {stage.quota_usage}")
    print(f"  Input: {stage.n_input}")
    print(f"  Output: {stage.n_output}")
```

## Estimation Logic

### Quota Costs per Endpoint

- **Channels**: 1 unit per 50 IDs
- **Videos**: 1 unit per 50 IDs
- **Playlists**: 1 unit per channel
- **Playlist Items**: 1 unit per playlist
- **Search**: 100 units per search
- **Comments**: 1 unit per video × pages
- **Captions**: 50 units per video

### Calculation

For each stage:

1. Estimate input size (from previous stage or initial input)
2. Calculate API calls needed
3. Multiply by quota cost per call
4. Sum all stages for total cost

## Display Options

### Display All Metrics

```python
report.display(metrics="all")
```

Shows:

- Overall quota cost
- Estimated execution time
- Total input/output items
- Per-stage breakdown

### Display Specific Metrics

```python
report.display(metrics="quota")      # Only quota costs
report.display(metrics="time")      # Only time estimates
report.display(metrics="items")     # Only item counts
```

## Branched Pipeline Estimation

```python
from yt_pipeline.pipeline.tree import BranchedPipelineEstimator

estimator = BranchedPipelineEstimator(pipeline=branched_pipeline)
report = estimator.estimate()
report.display(metrics="all")
```

Branched pipelines estimate costs for all branches in the tree.

## Example Output

```
=== Pipeline Estimation Report ===
Overall Quota Cost: 250
Estimated Execution Time: 45.2 seconds
Total Input Items: 1
Total Output Items: 150

Stage 1: search
  Quota Usage: 100
  Input Items: 1
  Output Items: 50

Stage 2: videos
  Quota Usage: 1
  Input Items: 50
  Output Items: 50

Stage 3: comments
  Quota Usage: 100
  Input Items: 50
  Output Items: 150
```

## Best Practices

1. **Always Estimate First** — Estimate before running large pipelines
2. **Check Quota Limits** — Ensure estimated cost is within daily quota
3. **Review Per-Stage Costs** — Identify expensive stages
4. **Adjust Settings** — Reduce `max_page` or input size if needed
5. **Monitor Actual Usage** — Compare estimates to actual execution reports

## Related Documentation

- **[Linear Pipeline](./linear-pipeline.md)** — Building pipelines
- **[Branched Pipeline](./branched-pipeline.md)** — Tree-based pipelines
- **[Use Cases](./use-cases.md)** — Practical examples

## Next Steps

- Learn about [Pipeline Construction](./pipeline-constructor.md)
- Read about [Pipeline Use Cases](./use-cases.md) for examples
