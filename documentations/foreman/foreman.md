> **Note**: This documentation was generated by AI and may contain inaccuracies. Please verify information and refer to the source code for authoritative details.

# Foreman Component

## Overview

The **Foreman** component orchestrates the complete data retrieval and structuring workflow. It combines a **Retriever**, **Container**, and **Shipper** into a single, high-level interface that provides structured, type-safe access to YouTube data.

## Purpose

Foremen provide a convenient, high-level interface that:

- Simplifies data retrieval (no need to manage retrievers directly)
- Provides structured, type-safe data access
- Handles the complete workflow automatically
- Integrates seamlessly with pipelines

## Key Features

1. **Complete Workflow** — Orchestrates Retriever → Container → Shipper automatically
2. **Structured Data** — Returns parsed, type-safe objects (containers) or flattened dictionaries (shippers)
3. **Error Handling** — Manages errors from retrievers and provides access to error information
4. **Flexible Output** — Can return containers (structured objects) or shippers (flattened dictionaries)
5. **Pipeline Integration** — Required component for building pipelines

## Architecture

Foremen orchestrate three components in sequence:

```
Input → Retriever → Raw API Response → Container → Structured Objects → Shipper → Flattened Dictionaries
```

### Foreman Types

#### 1. UniqueForeman

- **Base Class**: Uses `UniqueRetriever`
- **Use Case**: Batch processing (multiple IDs → multiple results)
- **Example**: Multiple channel IDs → channel details

#### 2. IterableForeman

- **Base Class**: Uses `IterableRetriever`
- **Use Case**: Paginated results (one ID → many results)
- **Example**: One channel ID → all playlists from that channel

#### 3. BaseForeman

- **Base Class**: General purpose
- **Use Case**: Specialized foremen (e.g., CaptionsForeman)

## Response Structure

Foremen can return data in two formats:

### 1. Container (Structured Objects)

When `as_box=True`:

- Returns container objects with structured dataclass items
- Type-safe access to data
- Preserves relationships and nested structures
- Example: `ChannelItem` objects with `snippet`, `statistics` attributes

### 2. Shipper (Flattened Dictionaries)

When `as_box=False` (default):

- Returns shipper objects with flattened dictionaries
- Easy to export to JSON, CSV, etc.
- Separates main records from thumbnails
- Example: `main_records` list and `thumbnails` dictionary

## Settings & Configuration

### RetrieverSettings

Controls the underlying retriever behavior (same as [Retriever Settings](../retriever/retriever.md#settings--configuration)).

### PipeSettings (for IterableForeman)

Controls pagination behavior (same as [PipeSettings](../retriever/retriever.md#pipesettings-for-iterableretriever)).

## Available Foremen

- **[ChannelsForeman](./channels.md)** — Retrieve and structure channel data
- **[VideosForeman](./videos.md)** — Retrieve and structure video data
- **[PlaylistsForeman](./playlists.md)** — Retrieve and structure playlist data
- **[PlaylistItemsForeman](./playlist_items.md)** — Retrieve and structure playlist item data
- **[SearchForeman](./search.md)** — Search and structure results
- **[CommentThreadsForeman](./comment_threads.md)** — Retrieve and structure comment threads
- **[CaptionsForeman](./captions.md)** — Retrieve and structure captions
- **[VideoCategoriesForeman](./video_categories.md)** — Retrieve and structure video categories

## When to Use Foremen

### Use Foremen When:

- You want structured, type-safe data access
- You need a simple, high-level interface
- You're building pipelines (foremen are required)
- You want automatic data parsing and organization
- You need both structured objects and flattened dictionaries

### Use Retrievers Directly When:

- You need raw API responses
- You're building custom processing logic
- You need fine-grained control over API calls

## Pipeline Integration

Foremen are the building blocks of pipelines. Each pipeline block uses a foreman:

```python
PipelineBlock(
    foreman=ChannelsForeman(),
    retriever_settings=RetrieverSettings(multithread=True),
    max_workers=8
)
```

Pipelines automatically:

- Extract IDs from one foreman's output
- Pass them as input to the next foreman
- Handle the complete workflow

## Error Handling

Foremen capture and manage errors:

- **Retriever Errors**: Stored in `foreman.errors` list
- **Ignored Errors**: Available via `foreman.ignored_errors`
- **Error Types**: `HttpErrorContainer` or `Exception` objects

## Example Usage

### Basic Usage (Returns Shipper)

```python
from yt_pipeline.foreman import ChannelsForeman
from yt_pipeline.retriever import RetrieverSettings

channel_ids = ["UC_x5XG1OV2P6uZZ5FSM9Ttw"]
devKey = "YOUR_API_KEY"

foreman = ChannelsForeman()
shipper = foreman.invoke(
    iterable=channel_ids,
    developerKey=devKey,
    retriever_settings=RetrieverSettings(multithread=True)
)

# Access flattened data
print(shipper.main_records)  # List of channel dictionaries
print(shipper.thumbnails)    # Dictionary of thumbnails by channel ID
```

### Container Output (Structured Objects)

```python
container = foreman.invoke(
    iterable=channel_ids,
    developerKey=devKey,
    as_box=True  # Return container instead of shipper
)

# Access structured data
for channel in container.items:
    print(channel.id)                    # Channel ID
    print(channel.snippet.title)         # Channel title
    print(channel.statistics.viewCount)  # View count
```

### In a Pipeline

```python
from yt_pipeline.pipeline import Pipeline, PipelineBlock, PipelineStacks
from yt_pipeline.foreman import ChannelsForeman, PlaylistsForeman

stacks = PipelineStacks(
    initial_input=["UC_x5XG1OV2P6uZZ5FSM9Ttw"],
    blocks=[
        PipelineBlock(foreman=ChannelsForeman()),
        PipelineBlock(foreman=PlaylistsForeman())
    ]
)

pipeline = Pipeline(stacks=stacks, developerKey=devKey)
result = pipeline.invoke()
```

## Related Components

- **[Retriever](../retriever/retriever.md)** — Used internally by foremen
- **[Container](../container/container.md)** — Parses raw responses into structured objects
- **[Shipper](../shipper/shipper.md)** — Flattens structured objects into dictionaries
- **[Pipeline](../pipeline/pipeline.md)** — Chains multiple foremen into workflows

## Next Steps

- Read about [Foreman Use Cases](./use-cases.md) for practical examples
- Explore specific foremen: [Channels](./channels.md), [Videos](./videos.md), [Search](./search.md)
- Learn about [Pipelines](../pipeline/pipeline.md) for automated workflows
