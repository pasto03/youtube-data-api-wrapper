> **Note**: This documentation was generated by AI and may contain inaccuracies. Please verify information and refer to the source code for authoritative details.

# Shipper Component

## Overview

The **Shipper** component flattens structured container objects into simple dictionaries, making data easy to export, serialize, and work with in a flat structure. It separates main records from thumbnails and provides backup functionality.

## Purpose

Shippers transform structured container objects into flat dictionaries that:

- Are easy to export to JSON, CSV, or other formats
- Provide a simple, flat data structure
- Separate main data from thumbnails for better organization
- Support automatic backup to files

## Key Features

1. **Data Flattening** — Converts nested dataclass objects into flat dictionaries
2. **Thumbnail Separation** — Separates thumbnails into a separate dictionary
3. **Backup Support** — Automatic backup to JSON files
4. **Export Ready** — Data is ready for JSON/CSV export
5. **Simple Structure** — Flat dictionaries are easier to work with than nested objects

## Architecture

Shippers sit at the end of the data flow:

```
Structured Objects (list[Item]) → Shipper → Flattened Dictionaries
```

### Shipper Structure

Each shipper maintains:

- **main_records**: List of flattened dictionaries (one per item)
- **thumbnails**: Dictionary mapping item IDs to their thumbnail lists
- **output_folder**: Default folder for backups

## Response Structure

### Main Records

A list of dictionaries, one per item. Each dictionary contains:

- Core fields: `kind`, `etag`, `id`
- Flattened snippet fields: `title`, `description`, `publishedAt`, etc.
- Flattened statistics: `viewCount`, `subscriberCount`, etc.
- **Note**: Thumbnails are NOT included in main_records

### Thumbnails

A dictionary mapping item IDs to lists of thumbnail dictionaries:

```python
{
    "item_id_1": [
        {"quality": "default", "url": "...", "width": "...", "height": "..."},
        {"quality": "medium", "url": "...", "width": "...", "height": "..."},
        ...
    ],
    "item_id_2": [...],
    ...
}
```

## Available Shippers

- **[ChannelsShipper](./channels.md)** — Flatten channel data
- **[VideosShipper](./videos.md)** — Flatten video data
- **[PlaylistsShipper](./playlists.md)** — Flatten playlist data
- **[PlaylistItemsShipper](./playlist_items.md)** — Flatten playlist item data
- **[SearchShipper](./search.md)** — Flatten search result data
- **[CommentThreadsShipper](./comment_threads.md)** — Flatten comment thread data (includes replies)
- **[CaptionsShipper](./captions.md)** — Flatten caption data
- **[VideoCategoriesShipper](./video_categories.md)** — Flatten video category data

## When to Use Shippers

### Use Shippers When:

- You need to export data to JSON/CSV
- You want a simple, flat data structure
- You're working with data in a tabular format
- You need to separate thumbnails from main data
- You want automatic backup functionality

### Use Containers When:

- You need type-safe, structured data access
- You want to preserve relationships and nested structures
- You're working with data programmatically
- You need IDE autocomplete and type checking

## Usage

Shippers are typically used through Foremen:

```python
from yt_pipeline.foreman import ChannelsForeman
from yt_pipeline.retriever import RetrieverSettings

foreman = ChannelsForeman()
shipper = foreman.invoke(
    iterable=["UC_x5XG1OV2P6uZZ5FSM9Ttw"],
    developerKey=devKey,
    retriever_settings=RetrieverSettings(multithread=True),
    backup_shipper=True  # Enable backup
)

# Access main records
for record in shipper.main_records:
    print(record['id'])
    print(record['title'])
    print(record['viewCount'])

# Access thumbnails separately
thumbnails = shipper.thumbnails["UC_x5XG1OV2P6uZZ5FSM9Ttw"]
for thumb in thumbnails:
    print(thumb['quality'], thumb['url'])
```

### Direct Usage

```python
from yt_pipeline.shipper import ChannelShipper
from yt_pipeline.container import ChannelsContainer

# Get container (from foreman or directly)
container = ChannelsContainer(raw_items=raw_response)

# Create shipper
shipper = ChannelShipper()
shipper.invoke(
    items=container.items,
    backup=True,
    output_folder="backup/channels"
)

# Access data
print(shipper.main_records)
print(shipper.thumbnails)
```

## Export Examples

### Export to JSON

```python
import json

# Export main records
with open("channels.json", "w") as f:
    json.dump(shipper.main_records, f, indent=2)

# Export thumbnails separately
with open("thumbnails.json", "w") as f:
    json.dump(shipper.thumbnails, f, indent=2)
```

### Export to CSV

```python
import csv

# Export main records
with open("channels.csv", "w", newline="") as f:
    writer = csv.DictWriter(f, fieldnames=shipper.main_records[0].keys())
    writer.writeheader()
    writer.writerows(shipper.main_records)
```

## Backup

Shippers can automatically backup data:

```python
shipper.invoke(
    items=container.items,
    backup=True,                    # Enable backup
    output_folder="backup/channels" # Custom folder
)
```

Backup creates two files:

- `{timestamp} main records.json` — Main records
- `{timestamp} thumbnails.json` — Thumbnails

## Special Cases

### CommentThreadsShipper

The `CommentThreadsShipper` has additional fields:

- `comment_threads`: List of comment thread records
- `replies`: Dictionary mapping comment IDs to reply lists

```python
shipper = CommentThreadsShipper()
# ... invoke ...

print(shipper.main_records)      # Video/comment metadata
print(shipper.comment_threads)   # Comment threads
print(shipper.replies)           # Replies to comments
```

## Related Components

- **[Container](../container/container.md)** — Provides structured objects to flatten
- **[Foreman](../foreman/foreman.md)** — Uses shippers internally and provides access to them
- **[Retriever](../retriever/retriever.md)** — Provides raw data that flows through containers to shippers

## Next Steps

- Read about [Shipper Use Cases](./use-cases.md) for practical examples
- Explore specific shippers: [Channels](./channels.md), [Videos](./videos.md), [CommentThreads](./comment_threads.md)
- Learn about [Containers](../container/container.md) for structured data access
