> **Note**: This documentation was generated by AI and may contain inaccuracies. Please verify information and refer to the source code for authoritative details.

> **⚠️ OBSOLETE**: The Regulator component is obsolete and no longer recommended for use. Instead, use the **Estimator** classes from `yt_pipeline.regulator.estimator` which are actively used throughout the codebase (especially by PipelineEstimator). See [Estimator Documentation](./estimator/estimator.md) for the current approach.

# Regulator Component (Obsolete)

## Overview

The **Regulator** component provides quota estimation and safety checks before executing API calls. It helps prevent accidental quota exhaustion by estimating costs and requiring user confirmation for large requests.

## Purpose

Regulators serve as a safety mechanism that:

- Estimates API quota costs before execution
- Prevents accidental quota exhaustion
- Provides user confirmation for large requests
- Helps plan and budget API usage

## Key Features

1. **Quota Estimation** — Estimates API quota costs based on input size
2. **Hard Limits** — Enforces maximum quota limits (default: 10,000 units)
3. **User Confirmation** — Requires user approval for large requests
4. **Bypass Option** — Allows bypassing regulation for trusted operations
5. **Cost Transparency** — Shows estimated costs before execution

## Architecture

Regulators wrap Retrievers:

```
Input → Regulator → Estimate Cost → Check Limits → User Confirmation → Retriever → Results
```

### Regulator Types

#### 1. UniqueRegulator

- **Base Class**: Wraps `UniqueRetriever`
- **Use Case**: Batch operations (channels, videos)
- **Example**: `ChannelsRegulator`, `VideosRegulator`

#### 2. IterableRegulator

- **Base Class**: Wraps `IterableRetriever`
- **Use Case**: Paginated operations (playlists, comments, search)
- **Example**: `PlaylistsRegulator`, `CommentThreadsRegulator`, `SearchRegulator`

## Usage

### Basic Usage

```python
from yt_pipeline.regulator import ChannelsRegulator
from yt_pipeline.retriever import ChannelsRetriever

channel_ids = ["UC_x5XG1OV2P6uZZ5FSM9Ttw", ...]  # Many channel IDs
devKey = "YOUR_API_KEY"

# Create retriever
retriever = ChannelsRetriever(
    iterable=channel_ids,
    developerKey=devKey
)

# Wrap with regulator
regulator = ChannelsRegulator(retriever=retriever)

# Invoke (will estimate and ask for confirmation)
results = regulator.invoke()
```

### With Bypass

```python
# Bypass regulation (use with caution)
results = regulator.invoke(bypass_regulation=True)
```

## Quota Estimation

Regulators estimate quota costs based on:

- **Input Size**: Number of items to process
- **Retriever Type**: Different retrievers have different costs
- **Settings**: Pagination settings affect costs

### Estimation Logic

- **UniqueRetriever**: Cost = (number of items / 50) × cost per API call
- **IterableRetriever**: Cost = number of items × pages × cost per API call

## Hard Limits

Regulators enforce a hard limit (default: 10,000 quota units). Requests exceeding this limit will be blocked unless:

- `bypass_regulation=True` is set
- User explicitly confirms (if confirmation is enabled)

## User Confirmation

When a request exceeds the hard limit, regulators:

1. Display estimated quota usage
2. Show the hard limit
3. Ask for user confirmation (Y/n)
4. Proceed only if confirmed

## Available Regulators

- **ChannelsRegulator** — Regulates channel retrieval
- **VideosRegulator** — Regulates video retrieval
- **PlaylistsRegulator** — Regulates playlist retrieval
- **PlaylistItemsRegulator** — Regulates playlist item retrieval
- **SearchRegulator** — Regulates search operations
- **CommentThreadsRegulator** — Regulates comment thread retrieval

## When to Use Regulators

### Use Regulators When:

- Processing large batches of data
- Working with production systems
- Need to prevent accidental quota exhaustion
- Want cost transparency before execution

### Skip Regulators When:

- Processing small batches (under hard limit)
- In development/testing environments
- Using pipelines (pipelines have their own estimation)
- Need maximum performance (regulators add overhead)

## Example Output

```
---API REGULATOR---
Estimated quota usage: 5000.
Do you want to proceed? (Y/n): y
```

Or if exceeding limit:

```
---API REGULATOR---
Estimated quota usage: 15000.
The request would exceed daily maximum quota cost (10000) if proceed.
API call aborted for usage concern.
Set bypass_regulation=True to bypass the abortion procedure.
```

## Best Practices

1. **Use for Large Batches** — Always use regulators for large operations
2. **Check Estimates** — Review estimates before confirming
3. **Monitor Quota** — Keep track of daily quota usage
4. **Use Pipelines** — Pipelines have built-in estimation (no need for regulators)
5. **Bypass Carefully** — Only bypass when you're certain about costs

## Related Components

- **[Estimator](./estimator/estimator.md)** — **Use this instead** — Current quota estimation approach
- **[Pipeline Estimator](../pipeline/pipeline-estimator.md)** — Uses estimators internally for pipeline cost calculation
- **[Retriever](../retriever/retriever.md)** — Wrapped by regulators (obsolete)
- **[Foreman](../foreman/foreman.md)** — Can be used with regulators (wrap the retriever) (obsolete)

## Migration to Estimator

The Regulator component is obsolete. For quota estimation, use the **Estimator** classes instead:

- **[Estimator Documentation](./estimator/estimator.md)** — Current quota estimation approach
- **[Pipeline Estimator](../pipeline/pipeline-estimator.md)** — Pipeline quota estimation (uses estimators internally)

## Next Steps

- **Use Estimator Instead**: See [Estimator Documentation](./estimator/estimator.md) for the recommended approach
- Learn about [Pipeline Estimation](../pipeline/pipeline-estimator.md) for pipeline quota management
