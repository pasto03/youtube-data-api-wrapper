> **Note**: This documentation was generated by AI and may contain inaccuracies. Please verify information and refer to the source code for authoritative details.

# Estimator Component

## Overview

The **Estimator** component provides quota cost estimation for YouTube Data API v3 operations. Estimator classes calculate the expected API quota cost based on input size, retriever type, and settings. These estimators are used throughout the codebase, especially by `PipelineEstimator` for pipeline quota estimation.

## Purpose

Estimators provide:

- **Quota Cost Calculation** — Calculate expected API quota costs
- **Planning Tool** — Help plan and budget API usage
- **Cost Transparency** — Understand costs before execution
- **Pipeline Integration** — Used by `PipelineEstimator` for pipeline cost estimation

## Key Features

1. **Type-Specific Estimation** — Different estimators for different retriever types
2. **Settings-Aware** — Considers pagination and retrieval settings
3. **Output Estimation** — Can estimate output item counts (for some estimators)
4. **Accurate Calculations** — Based on actual API quota costs per endpoint

## Architecture

Estimators are used by:

- **PipelineEstimator** — For pipeline quota estimation
- **Regulator** (obsolete) — Previously used by regulators
- **Direct Usage** — Can be used directly for custom estimation

## Estimator Types

### BaseEstimator

Base class for all estimators:

```python
class BaseEstimator:
    def __init__(self, cost_per_call=1):
        self.cost_per_call = cost_per_call

    def estimate(self):
        raise NotImplementedError
```

### UniqueEstimator

For retrievers that inherit `UniqueRetriever` (batch processing):

- **Cost Formula**: `cost = ceil(n_items / batch_size) × cost_per_call`
- **Batch Size**: Default 50 items per API call
- **Use Case**: Channels, Videos

**Example**:

```python
from yt_pipeline.regulator.estimator import ChannelsEstimator

estimator = ChannelsEstimator()
cost = estimator.estimate(n_items=150)  # 3 batches × 1 = 3 units
```

### IterableEstimator

For retrievers that inherit `IterableRetriever` (paginated results):

- **Cost Formula**:
  - If `retrieval="all"`: `cost = n_items × max_pages × cost_per_call`
  - Otherwise: `cost = n_items × cost_per_call`
- **Use Case**: Playlists, PlaylistItems, Search, CommentThreads

**Example**:

```python
from yt_pipeline.regulator.estimator import PlaylistEstimator
from yt_pipeline.retriever.base import PipeSettings

estimator = PlaylistEstimator()
settings = PipeSettings(retrieval="all", max_page=5)
cost = estimator.estimate(n_items=10, settings=settings)  # 10 × 5 × 1 = 50 units
```

### SingleEstimator

For retrievers that inherit `SingleRetriever`:

- **Cost Formula**: `cost = cost_per_call`
- **Use Case**: VideoCategories

## Available Estimators

### UniqueRetriever Estimators

- **ChannelsEstimator** — Estimates channel retrieval costs
  - Cost: 1 unit per 50 channel IDs
- **VideosEstimator** — Estimates video retrieval costs
  - Cost: 1 unit per 50 video IDs

### IterableRetriever Estimators

- **PlaylistEstimator** — Estimates playlist retrieval costs
  - Cost: 1 unit per channel × pages
- **PlaylistItemsEstimator** — Estimates playlist item retrieval costs
  - Cost: 1 unit per playlist × pages
- **SearchEstimator** — Estimates search operation costs
  - Cost: 100 units per search × pages
- **CommentThreadsEstimator** — Estimates comment thread retrieval costs
  - Cost: 1 unit per video × pages
  - Output per page: 100 comments

### SingleRetriever Estimators

- **VideoCategoriesEstimator** — Estimates video category retrieval costs
  - Cost: 1 unit per region

### Special Estimators

- **CaptionsEstimator** — Estimates caption retrieval costs
  - Cost: 50 units per video

## Usage

### Basic Usage

```python
from yt_pipeline.regulator.estimator import ChannelsEstimator

estimator = ChannelsEstimator()
n_items = 150
cost = estimator.estimate(n_items)
print(f"Estimated cost: {cost} units")  # 3 units (150 / 50 = 3 batches)
```

### With Settings

```python
from yt_pipeline.regulator.estimator import PlaylistEstimator
from yt_pipeline.retriever.base import PipeSettings

estimator = PlaylistEstimator()
settings = PipeSettings(retrieval="all", max_page=5)
n_items = 10
cost = estimator.estimate(n_items, settings)
print(f"Estimated cost: {cost} units")  # 50 units
```

### Output Count Estimation

Some estimators can also estimate output item counts:

```python
from yt_pipeline.regulator.estimator import CommentThreadsEstimator
from yt_pipeline.retriever.base import PipeSettings

estimator = CommentThreadsEstimator()
settings = PipeSettings(retrieval="all", max_page=3)
n_items = 5

cost, output_count = estimator.estimate(
    n_items,
    settings,
    estimate_output_count=True
)

print(f"Cost: {cost} units")  # 15 units (5 × 3 × 1)
print(f"Estimated outputs: {output_count} comments")  # 1500 comments (5 × 3 × 100)
```

### Custom Retrieval Settings

```python
from yt_pipeline.regulator.estimator import PlaylistItemsEstimator
from yt_pipeline.retriever.base import PipeSettings

estimator = PlaylistItemsEstimator()

# Custom retrieval
settings = PipeSettings(retrieval="custom", n=10)
cost = estimator.estimate(n_items=5, settings=settings)
print(f"Cost: {cost} units")  # 5 units (5 × 1)
```

## Quota Costs Reference

| Endpoint         | Cost per Call | Batch Size | Notes                   |
| ---------------- | ------------- | ---------- | ----------------------- |
| Channels         | 1 unit        | 50 IDs     | Batched automatically   |
| Videos           | 1 unit        | 50 IDs     | Batched automatically   |
| Playlists        | 1 unit        | 1 channel  | Paginated               |
| Playlist Items   | 1 unit        | 1 playlist | Paginated               |
| Search           | 100 units     | 1 search   | Paginated, expensive    |
| Comment Threads  | 1 unit        | 1 video    | Paginated, 100 per page |
| Captions         | 50 units      | 1 video    | Single call             |
| Video Categories | 1 unit        | 1 region   | Single call             |

## Integration with PipelineEstimator

Estimators are used internally by `PipelineEstimator`:

```python
from yt_pipeline.pipeline import PipelineEstimator
from yt_pipeline.regulator.estimator import ChannelsEstimator, VideosEstimator

# PipelineEstimator uses these estimators internally
# to calculate total pipeline cost
```

## Best Practices

1. **Use for Planning** — Estimate costs before running large operations
2. **Consider Settings** — Account for pagination settings in estimates
3. **Use in Pipelines** — PipelineEstimator uses these automatically
4. **Verify Estimates** — Compare estimates to actual costs
5. **Account for Pagination** — IterableEstimator estimates may be higher than actual (unknown page counts)

## Related Components

- **[Pipeline Estimator](../pipeline/pipeline-estimator.md)** — Uses estimators for pipeline cost calculation
- **[Retriever](../retriever/retriever.md)** — Estimators estimate costs for retrievers
- **[Regulator](./regulator.md)** — Obsolete component that previously used estimators

## Next Steps

- Learn about [Pipeline Estimation](../pipeline/pipeline-estimator.md) for pipeline quota management
- Read about [Retrievers](../retriever/retriever.md) to understand what estimators estimate
