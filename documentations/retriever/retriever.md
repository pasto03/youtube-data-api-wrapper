> **Note**: This documentation was generated by AI and may contain inaccuracies. Please verify information and refer to the source code for authoritative details.

# Retriever Component

## Overview

The **Retriever** component is the foundation of `yt_pipeline`. It directly calls the YouTube Data API v3 and handles all the low-level details of API communication, including pagination, multithreading, error handling, and response management.

## Purpose

Retrievers provide a clean interface to YouTube Data API v3 endpoints while abstracting away:

- HTTP request/response handling
- Pagination logic
- Error handling and retries
- Multithreading for batch operations
- Response backup and recovery

## Key Features

1. **Direct API Access** — Calls YouTube Data API v3 endpoints directly
2. **Pagination Support** — Automatically handles paginated responses for endpoints that return multiple pages
3. **Multithreading** — Process multiple requests concurrently for improved performance
4. **Error Handling** — Gracefully handles API errors and provides error containers
5. **Backup Support** — Optional automatic backup of responses to prevent data loss
6. **Batch Processing** — Efficiently processes multiple IDs in a single request when possible

## Architecture

Retrievers are the first layer in the `yt_pipeline` architecture:

```
Input (IDs/Params) → Retriever → Raw API Response (list[dict])
```

### Retriever Types

#### 1. UniqueRetriever

- **Purpose**: Batch processing for one-to-one mappings
- **Example**: Multiple channel IDs → channel details
- **Characteristics**:
  - Processes IDs in batches (up to 50 per API call)
  - Returns one result per input ID
  - Efficient for bulk data retrieval

#### 2. IterableRetriever

- **Purpose**: Paginated results for one-to-many mappings
- **Example**: One channel ID → all playlists from that channel
- **Characteristics**:
  - Handles pagination automatically
  - Can retrieve all pages or a limited number
  - Supports custom page limits and retrieval strategies

#### 3. SingleRetriever

- **Purpose**: Single item retrieval
- **Example**: One video ID → captions for that video
- **Characteristics**:
  - Returns a single result
  - Used for specialized endpoints

## Response Structure

Retrievers return **raw API responses** as Python dictionaries (`list[dict]`). The structure matches exactly what the YouTube Data API v3 returns:

- Each dictionary represents one resource (channel, video, playlist, etc.)
- Contains standard YouTube API fields: `kind`, `etag`, `id`, `snippet`, `statistics`, etc.
- No transformation or parsing is applied

**Note**: For structured, type-safe access to this data, use the **Container** component or **Foreman** (which uses containers internally).

## Settings & Configuration

### RetrieverSettings

Controls retriever execution behavior:

- `output_folder` (str): Where to save backup files
- `flatten_result` (bool): Whether to flatten nested results
- `filename` (str | None): Custom filename for backups
- `backup` (bool): Enable automatic backup
- `backup_when_halted` (bool): Backup even if execution is interrupted
- `multithread` (bool): Enable multithreaded execution

### PipeSettings (for IterableRetriever)

Controls pagination behavior:

- `retrieval` (str): Retrieval strategy
  - `"all"`: Retrieve all pages (up to `max_page`)
  - `"head"`: Retrieve first page only (50 items)
  - `"custom"`: Retrieve first page with custom item count (`n`)
- `n` (int): Number of items when `retrieval="custom"`
- `max_page` (int): Maximum number of pages to retrieve

## Available Retrievers

- **[ChannelsRetriever](./channels.md)** — Retrieve channel details
- **[VideosRetriever](./videos.md)** — Retrieve video details
- **[PlaylistsRetriever](./playlists.md)** — Retrieve playlists from channels
- **[PlaylistItemsRetriever](./playlist_items.md)** — Retrieve items from playlists
- **[SearchRetriever](./search.md)** — Search for channels, videos, or playlists
- **[CommentThreadsRetriever](./comment_threads.md)** — Retrieve comment threads from videos
- **[CaptionsRetriever](./captions.md)** — Retrieve captions for videos
- **[VideoCategoriesRetriever](./video_categories.md)** — Retrieve video category information

## When to Use Retrievers

### Use Retrievers Directly When:

- You need raw API responses
- You want full control over API calls
- You're building custom processing logic
- You need to integrate with other systems that expect raw API format

### Use Foremen Instead When:

- You want structured, type-safe data access
- You need automatic data parsing and organization
- You want a simpler, higher-level interface
- You're building pipelines (foremen are required for pipelines)

## Error Handling

Retrievers handle errors gracefully:

- **HTTP Errors**: Captured in `HttpErrorContainer` objects
- **Ignored Errors**: Stored in `ignored_errors` list
- **Fatal Errors**: Returned as part of the result tuple
- **Backup on Error**: Optional backup even when errors occur

## Performance Considerations

1. **Multithreading**: Enable for batch operations to improve speed
2. **Batch Size**: UniqueRetriever automatically batches up to 50 IDs per call
3. **Pagination**: Use `max_page` to limit pagination for large result sets
4. **Backup**: Disable if not needed to improve performance

## Example Usage

```python
from yt_pipeline.retriever import ChannelsRetriever, RetrieverSettings

channel_ids = ["UC_x5XG1OV2P6uZZ5FSM9Ttw", "UCuAXFkgsw1L7xaCfnd5JJOw"]
devKey = "YOUR_API_KEY"

# Create retriever
retriever = ChannelsRetriever(
    iterable=channel_ids,
    developerKey=devKey,
    max_workers=8
)

# Invoke with settings
settings = RetrieverSettings(
    multithread=True,
    backup=True,
    output_folder="backup/channels"
)

results = retriever.invoke(**settings.__dict__)
# Returns: list[dict] - raw API responses
```

## Related Components

- **[Foreman](../foreman/foreman.md)** — Uses retrievers internally and provides structured data
- **[Container](../container/container.md)** — Parses raw retriever responses into structured objects
- **[Pipeline](../pipeline/pipeline.md)** — Chains multiple foremen (which use retrievers) into workflows

## Next Steps

- Read about [Retriever Use Cases](./use-cases.md) for practical examples
- Explore specific retrievers: [Channels](./channels.md), [Videos](./videos.md), [Search](./search.md)
- Learn about [Foremen](../foreman/foreman.md) for structured data access
