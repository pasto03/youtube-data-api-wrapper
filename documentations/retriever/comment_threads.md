> **Note**: This documentation was generated by AI and may contain inaccuracies. Please verify information and refer to the source code for authoritative details.

# CommentThreadsRetriever

## Purpose

The `CommentThreadsRetriever` retrieves comment threads (top-level comments and replies) from YouTube videos given video IDs. It supports pagination to retrieve multiple pages of comments.

## Input Requirements

- **Input Type**: `list[str]` — List of video IDs
- **Format**: Video IDs in standard YouTube format (e.g., `"dQw4w9WgXcQ"`)
- **One-to-Many**: One video ID can return multiple comment threads

## Output Structure

Returns a list of dictionaries, each containing:

- **Core Fields**: `kind`, `etag`, `id`
- **Snippet**: Comment text, author information, published date, like count, reply count
- **Replies**: Nested replies to the comment (if any)
- **Video Information**: Video ID and snippet (if requested)

### Key Fields

- `id` — Comment thread ID
- `snippet.topLevelComment.snippet.textDisplay` — Comment text
- `snippet.topLevelComment.snippet.authorDisplayName` — Comment author
- `snippet.topLevelComment.snippet.publishedAt` — Comment publish date
- `snippet.topLevelComment.snippet.likeCount` — Number of likes
- `snippet.totalReplyCount` — Number of replies
- `replies.comments` — List of reply comments (if any)

## Common Use Cases

1. **Comment Analysis** — Analyze comments on videos
2. **Sentiment Analysis** — Process comment text for sentiment
3. **Engagement Metrics** — Track comment counts and likes
4. **Community Analysis** — Study commenter behavior
5. **Moderation** — Monitor comments for moderation

## Example Usage

### Basic Usage

```python
from yt_pipeline.retriever import CommentThreadsRetriever, PipeSettings

retriever = CommentThreadsRetriever(
    iterable=["dQw4w9WgXcQ"],
    developerKey=devKey,
    settings=PipeSettings(max_page=1)  # Get first page only
)

results = retriever.invoke()

for thread in results:
    comment = thread['snippet']['topLevelComment']['snippet']
    print(f"Author: {comment['authorDisplayName']}")
    print(f"Comment: {comment['textDisplay']}")
    print(f"Likes: {comment['likeCount']}")
    print(f"Replies: {thread['snippet']['totalReplyCount']}")
```

### Get Multiple Pages

```python
retriever = CommentThreadsRetriever(
    iterable=["dQw4w9WgXcQ"],
    developerKey=devKey,
    settings=PipeSettings(max_page=5)  # Get 5 pages of comments
)

results = retriever.invoke(multithread=True)
```

### Multiple Videos

```python
video_ids = ["dQw4w9WgXcQ", "jNQXAC9IVRw"]
retriever = CommentThreadsRetriever(
    iterable=video_ids,
    developerKey=devKey,
    settings=PipeSettings(max_page=3),
    max_workers=8
)

results = retriever.invoke(multithread=True)
```

## Special Considerations

1. **Pagination** — Videos can have thousands of comments; use `max_page` to limit
2. **Quota Cost** — 1 unit per API call per video
3. **Comment Limits** — Maximum 100 comments per page
4. **Disabled Comments** — Returns empty list if comments are disabled
5. **Replies** — Replies are nested within comment threads
6. **Moderation** — Some comments may be held for review and not appear

## Related Components

- **[CommentThreadsForeman](../foreman/comment_threads.md)** — Structured comment data access
- **[CommentThreadsContainer](../container/comment_threads.md)** — Parsed comment objects
- **[CommentThreadsShipper](../shipper/comment_threads.md)** — Flattened comment data (includes replies)

## Next Steps

- Read about [Retriever Use Cases](./use-cases.md) for more examples
- Learn about [CommentThreadsForeman](../foreman/comment_threads.md) for structured access
- Explore [Pipelines](../pipeline/pipeline.md) for automated workflows
